---
argument-hint: <タスク名>
---

# specs内の不明箇所をユーザーに質問して明確化します

このコマンドは `specs/[taskname]/` ディレクトリ内の全ドキュメントから「**不明**」と記載された箇所を抽出し、ユーザーに質問して明確化します。

【対象タスク名】
$ARGUMENTS

## 実行手順

### 1. タスクディレクトリの確認

タスク名が指定されている場合:
- `specs/[taskname]/` ディレクトリの存在を確認
- ディレクトリ内の全マークダウンファイルを取得

タスク名が指定されていない場合:
- `specs/` ディレクトリ内の利用可能なタスクをリスト表示
- ユーザーに選択を求める

### 2. 不明箇所の抽出

`specs/[taskname]/` および `specs/[taskname]/tasks/` 内の全マークダウンファイルを検索し、以下のパターンを抽出:

- 「**不明**」または「不明」と記載された箇所
- その周辺のコンテキスト（前後数行）
- 記載されている複数の案（案A、案B、案Cなど）

各不明箇所について以下の情報を収集:
- **ファイル名**: どのファイルに記載されているか
- **セクション名**: どのセクションの内容か
- **不明な内容**: 何が不明なのか
- **提示されている案**: 案A、案B、案Cなど

### 3. 不明箇所の整理とグループ化

抽出した不明箇所を以下のように整理:

```markdown
## 不明箇所の一覧

### 不明箇所 1: [不明な内容の要約]
- **ファイル**: overview.md
- **セクション**: Phase 1の目標
- **不明な内容**: 認証方式の選択
- **提示されている案**:
  - 案A: JWT認証
  - 案B: セッションベース認証
  - 案C: OAuth2.0

### 不明箇所 2: [不明な内容の要約]
...
```

### 4. ユーザーへの質問

各不明箇所について、AskUserQuestionツールを使用してユーザーに質問:

- 質問は明確で具体的にすること
- 提示されている案をそのまま選択肢として提示
- 1つずつ順番に質問するのではなく、可能な限り複数の質問をまとめて提示
- ユーザーが「その他」を選択した場合は自由記述で詳細を取得

例:
```
質問: Phase 1で使用する認証方式を選択してください
選択肢:
- 案A: JWT認証
- 案B: セッションベース認証
- 案C: OAuth2.0
```

### 5. 回答の反映

ユーザーの回答を元に、該当ファイルの「**不明**」箇所を更新:

**更新前**:
```markdown
## 認証方式
**不明**: 以下の案から選択
- 案A: JWT認証
- 案B: セッションベース認証
- 案C: OAuth2.0
```

**更新後**:
```markdown
## 認証方式
JWT認証を使用する
```

### 6. 完了報告

全ての不明箇所を更新後、以下を報告:

```
✅ 不明箇所を明確化しました
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📍 対象ディレクトリ: specs/[taskname]/
📝 更新されたファイル:
   - overview.md (2箇所更新)
   - specification.md (1箇所更新)
   - tasks/phase1-foundation.md (3箇所更新)
   ...

✨ 明確化された項目:
   1. Phase 1の認証方式: JWT認証
   2. データベース: PostgreSQL
   3. デプロイ環境: AWS
   ...

💡 次のアクション:
   - 仕様書の内容を確認してください
   - 必要に応じて `/sdd:break-down-phase [taskname]` でPhase別計画書を更新
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 注意事項

- 不明箇所が見つからない場合は、その旨を報告してコマンドを終了
- ユーザーが「その他」を選択した場合は、その内容をそのまま反映
- 更新時は「**不明**」の記述と案のリストを全て削除し、選択された内容のみを記載
- 複数ファイルにまたがる不明箇所も漏れなく更新すること
- 更新前に必ずファイルの内容を読み込み、正確な位置を特定すること
