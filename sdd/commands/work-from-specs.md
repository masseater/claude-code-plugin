---
argument-hint: <taskname> [phase.task]
---

# specs/[taskname]/配下の仕様書ドキュメントを読み込み、それに基づいて実装作業を行います

以下の引数で指定されたタスクについて、仕様書に基づいた実装作業を行ってください。

【引数】
$ARGUMENTS

## 引数の形式
- `[taskname]` - タスク名のみ指定した場合、そのタスクの最初から作業開始
- `[taskname] [phase].[task]` - Phase番号とタスク番号を指定した場合、そのタスクから作業開始
  - 例: `user-authentication 2.3` → user-authenticationのphase2のタスク3から開始

## 実行手順

### 1. タスクとPhase/タスクの特定
上記の引数を解析して作業対象を特定：

1. **引数が指定されている場合**
   - `[taskname]`のみ: specs/[taskname]/を対象とし、Phase 1から開始
   - `[taskname] [phase].[task]`: specs/[taskname]/を対象とし、指定されたPhaseとタスクから開始

2. **引数が指定されていない場合**
   - `specs/`ディレクトリ内のサブディレクトリを一覧表示
   - 複数のタスクがある場合、ユーザーに選択させる：
     「どのタスクで作業しますか？」
     - [1] specs/user-authentication/
     - [2] specs/payment-integration/
     - [3] specs/admin-dashboard/
   - 単一のタスクのみの場合は自動選択

3. **指定されたタスクディレクトリが存在しない場合**
   - エラーメッセージを表示: 「specs/[taskname]/ ディレクトリが見つかりません」
   - specs/配下の利用可能なタスクを一覧表示

### 2. 仕様書の確認
選択されたタスクディレクトリ（specs/[taskname]/）から以下のファイルを読み込んで内容を把握：

1. **specs/[taskname]/overview.md** - プロジェクト全体の概要とPhase構成を理解
2. **specs/[taskname]/specification.md** - 機能要件と非機能要件の詳細を確認
3. **specs/[taskname]/technical-details.md** - 技術的な実装方針を確認
4. **specs/[taskname]/tasks/phase{N}-{phaseName}.md** - 該当するPhaseの計画書を確認

### 3. 現在の状況確認
以下を確認してユーザーに報告：
- 各Phaseの現在の状態（未着手/進行中/完了/保留）
- 実装可能なPhaseの特定（依存関係を考慮）
- ブロッカーの有無

### 4. 作業開始位置の決定

#### 4-1. `[phase].[task]` が指定されている場合
1. 指定されたPhaseファイル（phase{N}-{phaseName}.md）を読み込む
2. 指定されたタスク番号のタスクを特定
3. そのタスクの依存関係を確認：
   - 依存関係が満たされていない場合、警告を表示し、ユーザーに続行するか確認
   - 依存関係が満たされている場合、そのまま続行
4. 指定されたタスクの詳細を表示し、実装計画に進む

#### 4-2. `[phase].[task]` が指定されていない場合
ユーザーに以下を質問：
「どのPhaseの作業を進めますか？」

選択肢：
- Phase {N}: {phaseName}（状態: 〇〇、依存関係: 〇〇）
- または、特定のタスク番号を指定（例: 2.3 でPhase 2のタスク3）

### 5. タスクの確認と実行計画
選択されたPhaseまたはタスクについて：

1. **仕様の確認**
   - specification.mdから該当機能の詳細仕様を抽出
   - technical-details.mdから技術的な実装方針を確認
   - Phase計画書から具体的なタスクとその依存関係を確認

2. **実行可能性の確認**
   - 依存関係が満たされているか確認
   - ブロッカーがないか確認
   - 必要なライブラリやツールが揃っているか確認

3. **実装計画の提示**
   TodoWriteツールを使用して以下を計画：
   - 実装するタスクのリスト（指定されたタスクから開始）
   - 各タスクの依存関係
   - 推定作業時間
   - テスト計画

4. **ユーザーに確認**
   「この計画で作業を開始してよろしいですか？」

### 6. 実装作業
承認後、以下の手順で作業を進める：

1. **実装**
   - specification.mdの要件を満たすコードを実装
   - technical-details.mdの技術方針に従う
   - 既存のコードベースとの整合性を保つ
   - any型は絶対に使用しない

2. **品質チェック**
   - コードレビュー基準に従っているか確認
   - エラーハンドリングが適切か確認
   - 関数型プログラミングのスタイルを意識（map/filterの活用）

3. **テスト**
   - Phase計画書のテスト計画に従ってテストを実装
   - ユニットテスト
   - 統合テスト（必要に応じて）

4. **ドキュメント更新**
   - コード内コメント
   - 必要に応じてREADMEやAPI仕様を更新

### 7. 完了報告と状態更新
作業完了後、以下を報告：

1. **実装内容のサマリー**
   - 実装した機能
   - 変更したファイル
   - 追加したテスト

2. **Phase状態の更新提案**
   「以下のファイルを更新してもよろしいですか？」
   - タスクの状態を「完了」に更新
   - Phase全体が完了した場合、Phaseの状態を「完了」に更新
   - specs/[taskname]/overview.mdのPhase状態を更新
   - 該当するspecs/[taskname]/tasks/phase{N}-{phaseName}.mdのタスク状態を更新
   - **タスク目次の更新**: Phase計画書の先頭にあるタスク目次の該当タスクの状態とTDDステップを更新

3. **次のアクション提案**
   - 次に実装可能になったタスク
   - ブロックが解除されたタスク
   - Phase全体が完了した場合、次のPhaseの提案
   - 次のタスク番号を提示（例: 「次は `/sdd:work-from-specs [taskname] 2.4` で続行できます」）

### 8. 品質チェックの実施
作業完了前に必ず以下を確認：

- [ ] 仕様書の要件を満たしているか
- [ ] 依存関係が適切に処理されているか
- [ ] エラーハンドリングが実装されているか
- [ ] テストが実装され、パスしているか
- [ ] any型を使用していないか
- [ ] 関数型のスタイルを意識しているか（配列操作など）
- [ ] 既存の類似実装を確認し、重複を避けているか
- [ ] 既存ライブラリで実現できないか検討したか

## 重要な注意事項

- **仕様書を常に参照**: 実装中は常にspecification.mdとtechnical-details.mdを参照し、要件から逸脱しないこと
- **依存関係の遵守**: Phase計画書に記載された依存関係を必ず確認し、順序を守ること
- **状態管理**: タスクやPhaseの状態を適切に更新すること（specs/[taskname]/配下のファイル）
- **品質基準**: CLAUDE.mdと.agents/README.mdの品質基準を遵守すること
- **コミュニケーション**: 不明点や仕様の矛盾があれば、実装前にユーザーに確認すること

## 使用例

1. タスク全体を最初から開始:
   `/sdd:work-from-specs user-authentication`

2. Phase 2のタスク3から開始:
   `/sdd:work-from-specs user-authentication 2.3`

3. 引数なしで対話的に選択:
   `/sdd:work-from-specs`
