---
argument-hint: <タスク名> [調査項目番号]
---

# research.mdの調査項目を実施し、結果を仕様書に反映します

このコマンドは `specs/[taskname]/research.md` の調査項目を1つずつ実施し、調査結果を関連ドキュメントに反映します。

【引数】
$ARGUMENTS

## 引数の形式
- `[taskname]` - タスク名のみ指定した場合、全ての未完了調査項目を順に実施
- `[taskname] [調査項目番号]` - 特定の調査項目のみ実施
  - 例: `user-authentication 1` → user-authenticationの調査項目1のみ実施

## 実行手順

### 1. タスクと調査項目の特定

1. **引数が指定されている場合**
   - `[taskname]`のみ: specs/[taskname]/research.mdから未完了の調査項目を抽出
   - `[taskname] [調査項目番号]`: 指定された調査項目のみを対象

2. **引数が指定されていない場合**
   - `specs/`ディレクトリ内のサブディレクトリを一覧表示
   - 複数のタスクがある場合、AskUserQuestionツールでユーザーに選択させる
   - 単一のタスクのみの場合は自動選択

3. **指定されたタスクディレクトリが存在しない場合**
   - エラーメッセージを表示: 「specs/[taskname]/ ディレクトリが見つかりません」
   - specs/配下の利用可能なタスクを一覧表示

### 2. research.mdの確認

1. **ファイルの存在確認**
   - `specs/[taskname]/research.md` の存在を確認
   - 存在しない場合: エラーメッセージを表示し、`/sdd:create-specs` コマンドの実行を提案

2. **調査項目の抽出**
   - research.mdから調査項目を抽出
   - 各調査項目の以下の情報を取得:
     - 調査項目名
     - カテゴリ
     - ステータス（未着手/調査中/完了）
     - 優先度
     - 調査内容
     - 調査方法
     - 判断基準
     - 影響範囲

3. **未完了調査項目のリスト表示**
   - ステータスが「未着手」または「調査中」の項目を表示
   - 調査項目が全て完了している場合: 完了メッセージを表示して終了

### 3. 調査項目の選択

**調査項目番号が指定されている場合**:
- 指定された番号の調査項目を特定
- その調査項目の詳細を表示
- 手順4へ進む

**調査項目番号が指定されていない場合**:
- 未完了の調査項目を優先度順に表示
- AskUserQuestionツールで以下を質問:
  ```
  どの調査項目から実施しますか？
  - [1] 調査項目1: [名前] (優先度: High, ステータス: 未着手)
  - [2] 調査項目2: [名前] (優先度: High, ステータス: 調査中)
  - [3] 調査項目3: [名前] (優先度: Medium, ステータス: 未着手)
  - 全て順番に実施
  ```

### 4. 調査の実施

選択された調査項目について、以下の手順で調査を実施:

#### 4-1. 調査ステータスの更新
- research.mdの該当調査項目のステータスを「調査中」に更新
- 全体ステータスも「調査中」に更新（まだ調査中でない場合）

#### 4-2. 調査内容の確認とプラン作成
1. **調査内容の分析**
   - 調査項目の「調査内容」と「調査方法」を確認
   - 何を調査すべきかを明確に理解

2. **調査プランの作成**
   - TodoWriteツールを使用して調査ステップを計画
   - 例:
     - コードベースの既存実装を調査
     - ドキュメント・ベストプラクティスを調査（WebSearchツール使用）
     - PoC実装（必要な場合）
     - ベンチマーク実施（必要な場合）
     - 結果の比較と分析

3. **ユーザーへの確認**
   - 調査プランを提示
   - 「この調査プランで進めてよろしいですか？」

#### 4-3. 調査の実行

調査方法に応じて適切なアプローチを選択:

**A. コードベース調査**
- 既存の実装パターンを確認
- 使用されているライブラリやフレームワークを確認
- 類似機能の実装方法を分析

**B. ドキュメント調査**
- WebSearchツールを使用して最新のベストプラクティスを調査
- 公式ドキュメントを参照
- 技術記事やブログを調査

**C. PoC（Proof of Concept）実装**
- 小規模な実装例を作成
- 動作確認とパフォーマンス測定
- 実装の難易度や工数を評価

**D. ベンチマーク**
- 複数の選択肢を比較
- パフォーマンス測定
- リソース使用量の確認

#### 4-4. 調査結果のまとめ

調査完了後、以下の情報をまとめる:

1. **調査結果**
   - 発見した事実
   - 各選択肢の長所・短所
   - パフォーマンス測定結果（該当する場合）
   - 実装の難易度評価

2. **結論**
   - 判断基準に基づいた推奨案
   - 選択の理由
   - 注意点やリスク

3. **影響範囲の確認**
   - この調査結果が影響するPhaseや機能を確認
   - 関連する他の調査項目があるか確認

### 5. 調査結果の反映

#### 5-1. research.mdの更新
- 該当調査項目の「調査結果」と「結論」セクションを更新
- ステータスを「完了」に更新
- 全体の調査完了項目数を更新

#### 5-2. 関連ドキュメントへの反映

調査結果を関連ドキュメントに反映:

**overview.md**:
- アーキテクチャや技術選定に関する調査結果を反映
- Phase構成に影響する場合は更新

**specification.md**:
- 機能要件や非機能要件に関する調査結果を反映
- 実装方法が決定した場合は詳細を追記

**technical-details.md**:
- 技術選定の結果を反映
- アーキテクチャ図やデータ設計に調査結果を反映
- API設計やセキュリティ方針を更新

#### 5-3. 不明箇所の解決

調査結果により「**不明**」と記載されていた箇所が明確になった場合:
- 該当箇所を具体的な内容に更新
- 複数の案（案A、案B、案C）を削除し、選択された案を記載

### 6. 全体ステータスの確認

#### 6-1. 調査完了チェック
- research.mdの全調査項目が完了しているか確認
- 完了していない項目がある場合、その数と内容を表示

#### 6-2. 全体ステータスの更新
- 全ての調査項目が完了している場合:
  - research.mdの全体ステータスを「完了」に更新
  - 調査完了後のチェックリストを全てチェック

### 7. 完了報告

```
✅ 調査項目を完了しました
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📍 対象タスク: [taskname]
📝 完了した調査項目:
   調査項目{N}: [調査項目名]

🔍 調査結果のサマリー:
   [調査結果の簡潔なまとめ]

📄 更新されたドキュメント:
   - research.md (ステータス更新、調査結果追記)
   - overview.md (更新箇所の説明)
   - specification.md (更新箇所の説明)
   - technical-details.md (更新箇所の説明)

📊 調査の進捗:
   完了: {完了数} / {総数}
   残り: {残数}項目

💡 次のアクション:
   - 残りの調査項目がある場合: `/sdd:conduct-research [taskname]` を再実行
   - 全調査完了の場合: `/sdd:break-down-phase [taskname]` でPhase別計画書を生成
   - 不明箇所がまだある場合: `/sdd:clarify-spec [taskname]` で明確化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**複数の調査項目を順に実施する場合**:
- 1つの調査項目が完了したら、次の未完了項目を自動的に表示
- ユーザーに「続けて次の調査項目を実施しますか？」と確認
- 承認されたら手順4に戻って次の調査項目を実施

## 重要な注意事項

- **調査は丁寧に**: 調査は実装の品質を左右する重要なステップです。時間をかけて丁寧に調査してください
- **判断基準の遵守**: 各調査項目の「判断基準」に基づいて結論を出すこと
- **エビデンスベース**: 推測ではなく、調査結果（ベンチマーク、ドキュメント、PoC）に基づいて判断すること
- **影響範囲の明確化**: 調査結果が影響する範囲を明確に把握し、関連ドキュメントを漏れなく更新すること
- **不明箇所の解決**: 調査により「**不明**」箇所が解決した場合は必ず更新すること
- **Phase分けは調査完了後**: 全ての調査項目が完了するまで `/sdd:break-down-phase` は実行しないこと

## 使用例

1. タスク全体の調査を順に実施:
   `/sdd:conduct-research user-authentication`

2. 特定の調査項目のみ実施:
   `/sdd:conduct-research user-authentication 2`

3. 引数なしで対話的に選択:
   `/sdd:conduct-research`
