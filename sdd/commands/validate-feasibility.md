---
argument-hint: <タスク名>
allowed-tools: ["Read", "Edit", "Glob", "Grep", "Task"]
---

# technical-details.md の実現可能性検証と更新

`specs/[taskname]/technical-details.md` を実際のプロジェクト構造と照らし合わせて検証し、矛盾や不整合がある場合は technical-details.md を更新します。

## 実行手順

### 1. タスク名の確認

引数で指定されたタスク名、または `specs/` ディレクトリ内の既存タスク一覧からタスクを選択。

タスク名が指定されていない場合、ユーザーに確認すること。

### 2. ステアリングドキュメントの読み込み

プロジェクト全体のコンテキストを把握するため、以下のステアリングドキュメントを読み込みます：

**`specs/_steering/product.md`**:
- プロダクトの目的とビジョン
- ターゲットユーザー
- 主要機能とビジネス目標

**`specs/_steering/tech.md`**:
- 技術スタックとアーキテクチャ
- 開発標準（型安全性、コード品質、テスト戦略）
- 重要な技術的決定事項

**`specs/_steering/structure.md`**:
- プロジェクト構造と命名規則
- コード組織原則
- モジュール境界

**ステアリングドキュメントが存在しない場合**:
- 警告メッセージを表示: 「⚠️ ステアリングドキュメントが見つかりません。プロジェクト固有のコンテキストなしで進めます。」
- `/sdd:steering` コマンドでステアリングドキュメントを作成することを推奨
- 処理は続行（ステアリングドキュメントは必須ではない）

### 3. technical-details.md の読み込み

`specs/[taskname]/technical-details.md` を読み込み、記載されている内容を把握：

- アーキテクチャ構成
- 技術スタック
- インフラ構成
- データベース設計
- API設計
- ファイル構造
- 依存ライブラリ
- その他全ての記載内容

### 4. プロジェクト構造の調査

technical-details.md に記載されている内容に関連する実際のプロジェクト構造を調査：

#### 4.1 技術スタックの確認

記載されている技術に関連する設定ファイルを確認：

- `package.json` - 依存ライブラリ、スクリプト、バージョン
- `tsconfig.json` / `jsconfig.json` - TypeScript/JavaScript設定
- `.node-version` / `.nvmrc` - Node.jsバージョン
- ビルドツールの設定ファイル（webpack.config.js, vite.config.ts, next.config.js など）
- その他、technical-details.md で言及されている設定ファイル全て

#### 4.2 ディレクトリ構造の確認

記載されているディレクトリやファイルパスが実際に存在するか、または既存の構造と整合するかを確認。

#### 4.3 データベース関連の確認

記載されているデータベース設計に関連する既存ファイルを確認：

- ORM/スキーマファイル（Prisma, TypeORM, Sequelize など）
- マイグレーションファイル
- データベース設定ファイル
- その他データベース関連の全てのファイル

#### 4.4 API構造の確認

記載されているAPIエンドポイントやルーティングに関連する既存ファイルを確認：

- ルーティングファイル
- コントローラー
- ミドルウェア
- API関連の全てのファイル

#### 4.5 その他の確認

technical-details.md で言及されている全ての要素について、実際のプロジェクト内の対応するファイルや設定を確認。

### 5. 整合性チェック

technical-details.md の記載内容と実際のプロジェクト構造を比較し、以下を確認：

- 記載されている技術スタックは既存のものと互換性があるか
- 記載されているディレクトリやファイルパスは既存の構造と整合するか
- 記載されているライブラリは既存の依存関係と競合しないか
- 記載されているバージョンは実現可能か
- 記載されている設計は既存のパターンと矛盾しないか
- その他、全ての記載内容が実際のプロジェクトで実現可能か

### 6. technical-details.md の更新

検証結果に基づいて、technical-details.md を更新：

#### 更新方針

1. **矛盾する記述の修正**
   - 既存プロジェクトと矛盾する箇所を実現可能な内容に修正

2. **曖昧な記述の具体化**
   - プロジェクト構造から判明した具体的な情報で更新
   - 曖昧な記述を具体的なパス、ファイル名、ライブラリ名に修正

3. **不足情報の補完**
   - 既存プロジェクトから必要な情報を補完
   - 実際のパスやファイル名を明記

4. **新規・既存の明示**
   - 新規作成が必要なものは「**新規作成**」として明記
   - 既存を利用するものは「**既存を利用**」として明記

5. **不明点の明記**
   - 判断できない箇所は「**不明**」と明記
   - 複数の実装案がある場合は「案A」「案B」として列挙

#### 更新時の注意事項

- 既存の構造を尊重し、既存の規約に従う
- 曖昧な表現を避け、具体的に記述
- 理想論ではなく、実際に実装可能な内容を記述
- 大規模な変更が必要な場合は段階的な移行方法を記述

### 7. 変更内容のサマリー表示

更新完了後、変更内容を表示：

```markdown
## technical-details.md 更新完了

### 変更内容

#### 修正した箇所
1. **[セクション名]**: [修正内容]
   - 変更前: [元の記述]
   - 変更後: [新しい記述]
   - 理由: [修正理由]

#### 追加した箇所
1. **[セクション名]**: [追加内容]
   - 理由: [追加理由]

#### 不明として残した箇所
1. **[セクション名]**: [不明な内容]
   - 理由: [判断できない理由]
   - 次のアクション: `/sdd:clarify-spec [taskname]` で明確化

### 次のアクション
- [ ] technical-details.md の内容を確認
- [ ] 不明箇所がある場合: `/sdd:clarify-spec [taskname]` を実行
- [ ] 問題なければ: `/sdd:plan-phases [taskname]` でPhase構成を作成
```

### 8. 完了報告

- 更新された technical-details.md のパスを表示
- 変更点のサマリーを表示
- 次に取るべきアクションを提示

## 注意事項

- 推測ではなく、実際のファイルやコードに基づいて判断すること
- 曖昧な表現を避け、具体的なパス、ファイル名、ライブラリ名を使用
- プロジェクトの既存の規約や構造を優先すること
- 判断できない箇所は「**不明**」と明記し、複数案がある場合は列挙すること

## ステアリングドキュメントレビュー（必須）

検証・更新後の technical-details.md がステアリングドキュメントに準拠しているか必ず steering-reviewer SubAgent を使用して確認してください：

```bash
# steering-reviewer SubAgentを使用（指摘のみ、修正は行わない）
Task(steering-reviewer): specs/[taskname]/technical-details.md をレビューしてください。tech.mdの技術スタックとの整合性、既存プロジェクトとの互換性、structure.mdの構造規約との整合性を確認してください。
```

## 矛盾チェック（必須）

検証・更新後、仕様書間の矛盾がないか必ず contradiction-checker SubAgent を使用して確認してください：

```bash
# contradiction-checker SubAgentを使用（指摘のみ、修正は行わない）
Task(contradiction-checker): specs/[taskname]/ の全ドキュメント間の矛盾をチェックしてください。technical-details.mdの変更が他のドキュメントと整合しているか確認してください。
```
